분산 트랜잭션은 2개 이상의 네트워크 상의 시스템에서 발생하는 트랜잭션을 의미한다

독립된 어려 데이터베이스에 동시에 접근하지만 하나의 작업처럼 처리되도록 동작해야 한다

### Two Phase Commit
- Coordinator : 트랜잭션을 관리하는 객체이며 다음과 같은 과정으로 트랜잭션을 관리한다
	- Coordinator에서 unique한 트랜잭션 ID를 생성하고 각 데이터베이스에 전달한다
	- 각 데이터베이스의 트랜잭션에서 락을 획득하기 위한 작업을 시작한다
	- 각 트랜잭션이 데이터를 쓰고 완료 시 Coordinator에게 작업이 완료되었음을 알린다.
	- 커밋할 준비가 되었다면, Cordinator가 Phase 1을 시작한다
	- 각 데이터베이스에게 Prepare 요청을 보내어 커밋 가능 여부를 묻고 커밋 여부를 결정한다.
	- 모든 데이터베이스가 커밋이 가능하다면 Phase 2를 시작한다
	- 커밋 요청을 전송한다.
	- 요청이 실패하더라도 Coordinator는 이것이 성공할 때까지 계속 retry하게 된다.

SAGA

> 보상 트랜잭션이란 정상적으로 수행된 트랜잭션을 취소 혹은 되돌리는 트랜잭션으로, INSERT 시 DELETE를,
> UPDATE 시 UPDATE를, CREATE 시 DROP을 하는 것이다.

트랜잭션을 통해 작동하는 rollback을 직접 구현해야하는 단점이 있지만 하나의 서비스가 다른 서비스의 데이터를 변경할 때 보상 트랜잭션이 필요하다. 

이러한 보상 트랜잭션들을 이벤트 형태로 소싱하여 서비스들끼리 이벤트를 주고받아 처리하는 것을 SAGA 패턴이라고 한다. 중계자의 존재 유무로 종류가 나뉜다
- Choreography : 현재 서비스에서 로컬 트랜잭션을 처리 한 후, 중계자 없이 바로 다음 서비스에게 이벤트를 넘긴다. 서비스들 중에서 하나라도 실패하면 보상 트랜잭션을 실행한다

- Orchestration : 중계자가 모든 트랜잭션을 처리하고 이벤트에 따라 수행할 작업을 참가자에게 알려준다 각 작업의 상태를 저장 및 해석하여 오류 발생 시 보상 트랜잭션을 실행한다.